{% extends "layout.twig" %}

{% block subtitle %}
  <a class="link" href="http://blog.flippening.watch/what-is-the-flippening/" target="_blank">What is &quot;the Flippening?&quot;</a>
  <!--  <a class="link" href="https://store.flippening.watch/" target="_blank">FLIPPENING T-SHIRTS, MUGS, & MORE!</a> -->
{% endblock %}

{% block content %}

<!--<img id="toggle-color" src="../images/sun.png"/>-->

<!-- Flippening Watch Charts Google Ad 1 -->
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 ad">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-3200453829299141"
          data-ad-slot="6619357522"
          data-ad-format="auto"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>

<div id="marketCapRatio" class="container-fluid table-container market-share-comparison">

  <div class="row transparent">
    <div class="col-xs-12">
      <h2>Market Cap Ratio</h2>
      <p>ETH/BTC</p>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <div class="chart-container">
          <canvas id="marketCapRatio_chart" class="chart"></canvas>
      </div>
    </div>
  </div>

</div>

<!-- Flippening Watch Charts Google Ad 2 -->
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 ad full-padding">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-3200453829299141"
           data-ad-slot="2197014329"
           data-ad-format="auto"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>


<div id="marketShareComparison" class="container-fluid table-container market-share-comparison">

  <div class="row transparent">
    <div class="col-xs-12">
      <h2>Market Share</h2>
      <p>Historic: ETH, BTC, XRP</p>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <div class="chart-container">
          <canvas id="marketShareComparison_chart" class="chart"></canvas>
      </div>
    </div>
  </div>

</div>



<!-- Flippening Watch Charts Google Ad 3 -->
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 ad full-padding">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-3200453829299141"
           data-ad-slot="9762797128"
           data-ad-format="auto"></ins>
      <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>


<div id="marketShareTop15" class="container-fluid table-container market-share-comparison">

  <div class="row transparent">
    <div class="col-xs-12">
      <h2>Market Share</h2>
      <p>Current: Top 15</p>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <div class="pie-chart-container">
          <canvas id="marketSharePieChart" class="chart"></canvas>
      </div>
    </div>
  </div>

</div>


<!-- Flippening Watch Charts Google Ads 4 -->
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 ad full-padding">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3200453829299141"
             data-ad-slot="8637340833"
             data-ad-format="auto"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>


<div id="marketCapComparison" class="container-fluid table-container market-share-comparison">

  <div class="row transparent">
    <div class="col-xs-12">
      <h2>Market Cap</h2>
      <p>ETH vs. BTC</p>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <div class="chart-container">
          <canvas id="marketCapComparison_chart" class="chart"></canvas>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="container-fluid">
    <div class="row twitter">
      <div class="col-xs-12">
        <a href="https://twitter.com/flippeningwatch" class="twitter-follow-button" data-size="large" data-show-count="true">Follow @flippeningwatc</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <p>
            <a class="link" href="https://store.flippening.watch" target="_blank"/>STORE</a> |
            <a class="link" href="http://blog.flippening.watch/advertising/" target="_blank">ADVERTISE</a>
        </p>
        <p>
            <a class="link" href="http://blog.flippening.watch/about/" target="_blank">ABOUT</a> |
            <a class="link" href="http://blog.flippening.watch/contact/" target="_blank">CONTACT</a> |
            <a class="link" href="http://blog.flippening.watch/sources-and-formulas/" target="_blank">SOURCES</a>
        </p>
        <p class="copyright">Donate ETH: flippeningwatch.eth</p>
        <p class="copyright">0x00f2d1D2f91AD66Fb9828a0a6c299515aA969743</p>
        <p class="copyright">&copy; 2017 <a href="http://poltavastreet.company/" target="_blank">poltava Street Company</a></p>
      </div>
    </div>
  <div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
<script type="text/javascript" src="../js/moment.js"></script>

<script>

/* price ticker data */
var btc       = {{ api[0] }};
var eth       = {{ api[1] }};
var eth_price = {{ api[2] }};
var btc_price = {{ api[3] }};
var mkt_cap   = {{ api[4] }};

var btc_dom = (btc / mkt_cap) * 100;
var eth_dom = (eth / mkt_cap) * 100;
var pct_dom = (eth / btc) * 100;

eth_price = eth_price.toFixed(2);

$('#eth_price').html("$" + eth_price.toLocaleString('en-US') );
$('#btc_price').html("$" + btc_price.toLocaleString('en-US') );
$('#btc_dom').html("BTC MS: " + btc_dom.toFixed(1) + "%");
$('#eth_dom').html("ETH MS: " + eth_dom.toFixed(1) + "%");
$('#pct_dom').html("ETH/BTC: " + pct_dom.toFixed(1) + "%");




/* graph data */

var pct = 0;

var labelArray = [];
var data_set = [];
var eth_data = [];
var xrp_data = [];
var bch_data = [];

var flippening_ratio = [];

var total_mktcap = [];
var btc_mkt_cap_pct = [];
var eth_mkt_cap_pct = [];
var xrp_mkt_cap_pct = [];
var bch_mkt_cap_pct = [];

{% for cap in ethdata %}
  eth_data.push({{ cap }});
{% endfor %}

{% for item in dataset %}
  data_set.push( {{ item }} );
{% endfor %}

{% for cap in xrpdata %}
  xrp_data.push({{ cap }});
{%endfor%}

{% for cap in bchdata %}
  bch_data.push({{ cap }});
  console.log({{cap}});

{%endfor%}

{% for item in total_mktcap_dataset %}
  total_mktcap.push( {{ item }} );
{% endfor %}

{% for time in times %}
  labelArray.push("{{ time }}");
{% endfor %}

/* reverse datasets so the earliest points to most recent points */
labelArray.reverse();
data_set.reverse();
eth_data.reverse();
xrp_data.reverse();
bch_data.reverse();
total_mktcap.reverse();


/* create array of flippening ratios */
for (let i = 0; i < data_set.length; i++) {
  var ratio = (eth_data[i]/data_set[i])*100;
  var btc_ratio = (data_set[i]/total_mktcap[i])*100;
  var eth_ratio = (eth_data[i]/total_mktcap[i])*100;
  var xrp_ratio = (xrp_data[i]/total_mktcap[i])*100;
  var bch_ratio = (bch_data[i]/total_mktcap[i])*100;
  flippening_ratio.push(ratio);
  btc_mkt_cap_pct.push(btc_ratio);
  eth_mkt_cap_pct.push(eth_ratio);
  xrp_mkt_cap_pct.push(xrp_ratio);
  bch_mkt_cap_pct.push(bch_ratio);
}

/* market cap comparison chart */
var ctx = document.getElementById("marketCapComparison_chart").getContext('2d');
Chart.defaults.global.defaultColor = 'rgba(0,0,0,0)';
Chart.defaults.global.defaultFont = "Raleway";
Chart.defaults.global.defaultFontSize = 14;
Chart.defaults.global.defaultFontColor = '#000';

var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: labelArray,
        datasets: [{
              label: 'ETHEREUM',
              data: eth_data,
              backgroundColor: 'rgba(50,51,51,0.6)',
              borderColor: 'rgba(50,51,51,1)',
              borderWidth: 2,
              pointRadius: 0,
              pointBackgroundColor: 'rgba(50,51,51,0.6)',
              pointBorderColor: 'rgba(50,51,51,1)'
          },
          {
            label: 'BITCOIN',
            data: data_set,
            backgroundColor: 'rgba(250,144,57,0.5)',
            borderColor: 'rgba(250,144,57,1)',
            borderWidth: 2,
            pointRadius: 0,
            pointBackgroundColor: 'rgba(250,144,57,0.5)',
            pointBorderColor: 'rgba(250,144,57,1)'
          }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      tooltips: {
            mode: 'x',
            intersect: false,
            displayColors: true,
            callbacks: {
              label: function(tooltipItem, data) {
                return "$" + Number(tooltipItem.yLabel).toFixed(0).replace(/./g, function(c, i, a) {
                  return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
                });
              },
              title: function(tooltipItem, data) {
                newDate = data.labels[tooltipItem[0].index];
                return moment.utc(newDate).format('MMMM Do YYYY');
              }
            }
        },
        elements: {
            line: {
                tension: 0, // disables bezier curves
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true,
                    callback: function(value, index, values) {
                        return '$' + value/1000000000 + "B";
                    }
                }
            }],
            xAxes: [{
              gridLines: {
                color: "#FFFFFF"
              },
              ticks: {
                  callback: function(value, index, values) {
                      return moment.utc(value).format('MM / YYYY');
                  }
              }

            }]
        }
    }
});

/* market cap ratio chart */
var ctxratio = document.getElementById("marketCapRatio_chart").getContext('2d');
var gradient = ctxratio.createLinearGradient(1000, 500, 1000, 200);
gradient.addColorStop(0, '#03fcfe');
gradient.addColorStop(1, '#13ff00');

var newChart = new Chart(ctxratio, {
  type: 'line',
  data: {
    labels: labelArray,
    datasets: [{
      label: '% TO FLIPPENING',
      data: flippening_ratio,
      backgroundColor: gradient,
      borderColor: 'rgba(50,51,51,1)',
      borderWidth: 2,
      pointRadius: 0,
      pointBackgroundColor: gradient,
      pointBorderColor: 'rgba(50,51,51,0.6)'
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    tooltips: {
      mode: 'nearest',
      intersect: false,
      displayColors: true,
      callbacks: {
        label: function(tooltipItem, data) {
          return Number(tooltipItem.yLabel).toFixed(1) + "%";
        },
        title: function(tooltipItem, data) {
          newDate = data.labels[tooltipItem[0].index];
          return moment.utc(newDate).format('MMMM Do YYYY');
        }
      }
    },
    elements: {
        line: {
            tension: 0, // disables bezier curves
        }
    },
    scales: {
      yAxes: [{
        ticks: {
          beginAtZero:true,
          max: 100,
          callback: function(value, index, values) {
            return value + "%";
          }
        }
      }],
      xAxes: [{
        gridLines: {
          color: "#FFFFFF"
        },
        ticks: {
          callback: function(value, index, values) {
            return moment.utc(value).format('MM / YYYY');
          }
        }
      }]
    }
  }
});


/* market share chart */
var mksh = document.getElementById("marketShareComparison_chart").getContext('2d');
Chart.defaults.global.defaultColor = 'rgba(0,0,0,0)';
Chart.defaults.global.defaultFont = "Raleway";
Chart.defaults.global.defaultFontSize = 14;
Chart.defaults.global.defaultFontColor = '#000';

var mkshChart = new Chart(mksh, {
  type: 'line',
  data: {
    labels: labelArray,
    datasets: [
      {
        label: 'RIPPLE',
        data: xrp_mkt_cap_pct,
        backgroundColor: 'rgba(0,137,193,0.7)',
        borderColor: 'rgba(0,50,125,1)',
        borderWidth: 2,
        pointRadius: 0,
        pointBackgroundColor: 'rgba(0,137,193,0.7)',
        pointBorderColor: 'rgba(0,50,125,1)'
      },
      {
        label: 'ETHEREUM',
        data: eth_mkt_cap_pct,
        backgroundColor: 'rgba(50,51,51,0.6)',
        borderColor: 'rgba(50,51,51,1)',
        borderWidth: 2,
        pointRadius: 0,
        pointBackgroundColor: 'rgba(50,51,51,0.6)',
        pointBorderColor: 'rgba(50,51,51,1)'
      },
      {
        label: 'BITCOIN',
        data: btc_mkt_cap_pct,
        backgroundColor: 'rgba(250,144,57,0.5)',
        borderColor: 'rgba(250,144,57,1)',
        borderWidth: 2,
        pointRadius: 0,
        pointBackgroundColor: 'rgba(250,144,57,0.5)',
        pointBorderColor: 'rgba(250,144,57,1)'
      },
      {
        label: 'BITCOIN CASH',
        data: bch_mkt_cap_pct,
        backgroundColor: 'rgba(0,128,0,0.5)',
        borderColor: 'rgba(0,128,0,1)',
        borderWidth: 2,
        pointRadius: 0,
        pointBackgroundColor: 'rgba(0,128,0,0.5)',
        pointBorderColor: 'rgba(0,128,0,1)'
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    tooltips: {
          mode: 'x',
          intersect: false,
          displayColors: true,
          callbacks: {
            label: function(tooltipItem, data) {
              return Number(tooltipItem.yLabel).toFixed(1) + "%";
            },
            title: function(tooltipItem, data) {
              newDate = data.labels[tooltipItem[0].index];
              return moment.utc(newDate).format('MMMM Do YYYY');
            }
          }
      },
      elements: {
          line: {
              tension: 0, // disables bezier curves
          }
      },
      scales: {
          yAxes: [{
            ticks: {
              beginAtZero:true,
              max: 100,
              callback: function(value, index, values) {
                return value + "%";
              }
            }
          }],
          xAxes: [{
            gridLines: {
              color: "#FFFFFF"
            },
            ticks: {
                callback: function(value, index, values) {
                    return moment.utc(value).format('MM / YYYY');
                }
            }

          }]
      }
  }
});


/* market shares pie chart */
var marketShares = [];
var marketSharesLabels = [];
var marketSharesCaps = [];
var marketSharesPct = [];
var marketSharesColors = [];
var currencyColors = {
  "Bitcoin":"#fa9039",
  "Bitcoin Cash":"#fa9039",
  "Ethereum":"#323333",
  "Ripple":"#0089c1",
  "Litecoin":"#8c8c8c",
  "Dash":"#1c75bc",
  "NEM":"#00c4b3",
  "Ethereum Classic":"#639076",
  "IOTA":"#020202",
  "Monero":"#ff6600",
  "Stratis":"#4db5e8",
  "EOS":"#070707",
  "BitConnect":"#f47c28",
  "Qtum":"#4cb5dc",
  "NEO":"#6ebb49",
  "Waves":"#32b9cf",
  "BitShares":"#35baeb",
  "Zcash":"#f6c063",
  "OmiseGO":"#1659e7",
  "Hshare":"#544684",
  "Other":"#FF00CC"
};
var totalTopCurrencies = 0;

{%for currency in api[5:]%}
  marketShares.push("{{currency}}");
{%endfor%}

for(var i = 0; i < marketShares.length; i=i+3){
  marketSharesLabels.push(marketShares[i]);
}
for(var i = 2; i < marketShares.length; i=i+3){
  marketSharesCaps.push(marketShares[i]);
  marketSharesPct.push( ((marketShares[i]/mkt_cap)*100).toFixed(2) );
  totalTopCurrencies = totalTopCurrencies + Number(marketShares[i]);
}
for(var i = 0; i < marketSharesLabels.length; i++){
  marketSharesColors.push(currencyColors[marketSharesLabels[i]]);
}
marketSharesLabels.push("Other");
marketSharesCaps.push(mkt_cap - totalTopCurrencies);
marketSharesPct.push( ((1 - (totalTopCurrencies/mkt_cap))*100).toFixed(2) );
marketSharesColors.push(currencyColors["Other"]);

for(var i = 0; i < marketSharesLabels.length; i++) {
  var item = marketSharesLabels[i];
  item = item.toUpperCase();
  marketSharesLabels[i] = item;
}


var pie = document.getElementById("marketSharePieChart").getContext('2d');
var marketSharesChart = new Chart(pie,{
  type: 'doughnut',
  data: {
    labels:marketSharesLabels,
    datasets:[{
      data:marketSharesCaps,
      backgroundColor: marketSharesColors,
      borderWidth: 1
    }],
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    cutoutPercentage: 45,
    tooltips: {
      callbacks: {
        label: function(tooltipItem, data) {
          return ' $' + Number(data.datasets[0].data[tooltipItem.index]).toFixed(0).replace(/./g, function(c, i, a) {
            return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
          });
        },
        title: function(tooltipItem, data) {
          return data.labels[tooltipItem[0].index] + ': ' + marketSharesPct[tooltipItem[0].index] + '%';
        }
      }
    }
  }
});



</script>


{% endblock %}
