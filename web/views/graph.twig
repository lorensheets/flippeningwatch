{% extends "layout.html" %}

{% block content %}

<!--<img id="toggle-color" src="../images/sun.png"/>-->

<div class="container-fluid">

  <div class="row ticker">
    <div class="col-xs-0 col-sm-1"></div>
    <div class="col-xs-12 col-sm-10">
      <div class="row">
        <div class="col-xs-12 col-sm-3">
          <div class="row">
            <div class="col-xs-12 price">
              <img src="../images/bitcoin.png"/>
              <p id="btc_price"></p>
              <img class="invert" src="../images/ethereum.png"/>
              <p id="eth_price"></p>
            </div>
          </div>
        </div>
        <div class="col-xs-12 col-sm-9">
          <div class="row">
            <div class="col-xs-4 border-rt">
              <p id="btc_dom"></p>
            </div>
            <div class="col-xs-4 border-rt">
              <p id="eth_dom">%</p>
            </div>
            <div class="col-xs-4">
              <p id="pct_dom"></p>
            </div>
          </div>
        </div>

      </div>
    </div>
    <div class="col-xs-0 col-sm-1"></div>
  </div>

  <div class="row">
    <div class="col-xs-12 title">
      <img class="logo" src="../favicon/android-icon-192x192.png" alt="logo"/>
      <h1>Flippening Watch</h1><br>
      <a class="link" href="http://blog.flippening.watch/index.php/2017/06/13/what-is-the-flippening/" target="_blank">What is &quot;the Flippening?&quot;</a>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xs-12 ad fivepx-top-padding">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Flippening Watch charts 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3200453829299141"
     data-ad-slot="6619357522"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>

<div class="container-fluid table-container">

  <div class="row transparent">
    <div class="col-xs-12">
      <h2>Market Cap (Absolute)</h2>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <div class="chart-container">
          <canvas id="myChart"></canvas>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="container-fluid">
    <div class="row twitter">
      <div class="col-xs-12">
        <a href="https://twitter.com/flippeningwatch" class="twitter-follow-button" data-size="large" data-show-count="true">Follow @flippeningwatc</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <p>
            <a class="link" href="https://store.flippening.watch" target="_blank"/>STORE</a> |
            <a class="link" href="http://blog.flippening.watch/advertising/" target="_blank">ADVERTISE</a>
        </p>
        <p>
            <a class="link" href="http://blog.flippening.watch/about/" target="_blank">ABOUT</a> |
            <a class="link" href="http://blog.flippening.watch/contact/" target="_blank">CONTACT</a> |
            <a class="link" href="http://blog.flippening.watch/sources-and-formulas/" target="_blank">SOURCES</a>
        </p>
        <p class="copyright">Donate ETH: flippeningwatch.eth</p>
        <p class="copyright">0x00f2d1D2f91AD66Fb9828a0a6c299515aA969743</p>
        <p class="copyright">&copy; 2017 <a href="http://poltavastreet.company/" target="_blank">poltava Street Company</a></p>
      </div>
    </div>
  <div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
<script type="text/javascript" src="../js/moment.js"></script>

<script>

/* graph data */

var pct = 0;

var labelArray = [];
var data_set = [];
var times = [];
var eth_data = [];
var eth_times = [];

{% for cap in ethdata %}
  eth_data.push({{ cap }});
{% endfor %}

{% for item in dataset %}
      data_set.push( {{ item }} );
{% endfor %}

{% for time in times %}
      labelArray.push( {{ time }} );
{% endfor %}

for (var i = 0; i < labelArray.length; i++) {
  var newTime = labelArray[i]*1000;
  /*var newTime = moment.utc(labelArray[i] * 1000).format('MM / YYYY');*/
  times.push(newTime);
}

/* difference number of datapoints in bitcoin and ethereum datasets */
var btc_datapoints = data_set.length;
var eth_datapoints = eth_data.length;
console.log(btc_datapoints);
console.log(eth_datapoints);
var diff = btc_datapoints - eth_datapoints;

/* add difference to ethereum dataset with value of zero for each new point */
for (var i = 0; i < diff; i++) {
  eth_data.push(0);
}

/* reverse ethereum dataset so its earliest points to most recent points */
eth_data.reverse();

var ctx = document.getElementById("myChart").getContext('2d');
Chart.defaults.global.defaultColor = 'rgba(0,0,0,0)';
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: times,
        datasets: [{
            label: 'Bitcoin Market Cap',
            data: data_set,
            backgroundColor: [
                'rgba(250,144,57,0.4)'
            ],
            borderColor: [
                'rgba(250,144,57,1)'
            ],
            borderWidth: 2,
            pointRadius: 0
        },
        {
            label: 'Ethereum Market Cap',
            data: eth_data,
            backgroundColor: [
                'rgba(50,51,51,0.6)'
            ],
            borderColor: [
                'rgba(50,51,51,1)'
            ],
            borderWidth: 2,
            pointRadius: 0
        }],

    },
    options: {
      tooltips: {
            mode: 'x',
            intersect: false,
            callbacks: {
              label: function(tooltipItem, data) {
                return "$" + Number(tooltipItem.yLabel).toFixed(0).replace(/./g, function(c, i, a) {
                  return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
                });
              },
              title: function(tooltipItem, data) {
                newDate = data.labels[tooltipItem[0].index];
                return moment.utc(newDate).format('MMMM Do YYYY');
              }
            }
        },
      elements: {
            line: {
                tension: 0, // disables bezier curves
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true,
                    callback: function(value, index, values) {
                        return '$' + value/1000000000 + "B";
                    }
                }
            }],
            xAxes: [{
              gridLines: {
                color: "#FFFFFF"
              },
              ticks: {
                  callback: function(value, index, values) {
                      return moment.utc(value).format('MM / YYYY');
                  }
              }

            }]
        }
    }
});



/* price ticker data */

var btc       = {{ api[0] }};
var eth       = {{ api[1] }};
var eth_price = {{ api[2] }};
var btc_price = {{ api[3] }};
var mkt_cap   = {{ api[4] }};

var btc_dom = (btc / mkt_cap) * 100;
var eth_dom = (eth / mkt_cap) * 100;
var pct_dom = (eth / btc) * 100;

eth_price = eth_price.toFixed(2);

$('#eth_price').html("$" + eth_price.toLocaleString('en-US') );
$('#btc_price').html("$" + btc_price.toLocaleString('en-US') );
$('#btc_dom').html("BTC DOM: " + btc_dom.toFixed(1) + "%");
$('#eth_dom').html("ETH DOM: " + eth_dom.toFixed(1) + "%");
$('#pct_dom').html("ETH/BTC: " + pct_dom.toFixed(1) + "%");

</script>


{% endblock %}
